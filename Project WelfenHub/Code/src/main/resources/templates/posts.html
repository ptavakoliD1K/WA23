<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Posts</title>
    <link rel="stylesheet" href="css/forum_styles.css" />
</head>
<body>
<!-- Include Header -->
<div th:insert="fragments/header :: header"></div>

<h1>Forum</h1>

<!-- Filter Form -->
<form th:action="@{/posts}" method="get">
    <select name="category">
        <option value="">All Categories</option>
        <option value="Allgemeine Frage">Allgemeine Frage</option>
        <option value="Wirtschaftsinformatik">Wirtschaftsinformatik</option>
        <option value="BWL">BWL</option>
        <option value="Parkplatz">Parkplatz</option>
        <option value="Sonstiges">Sonstiges</option>
    </select>
    <button type="submit">Filter</button>
</form>

<hr/>

<!-- Form to create a new post -->
<form th:action="@{/posts/create}" method="post">
    <label>Title:</label>
    <input type="text" name="title" required /><br/>

    <label for="content">Content:</label>
    <textarea id="content" name="content" required></textarea><br/>

    <label for="category">Category:</label>
    <select id="category" name="category" required>
        <option value="Allgemeine Frage">Allgemeine Frage</option>
        <option value="Wirtschaftsinformatik">Wirtschaftsinformatik</option>
        <option value="BWL">BWL</option>
        <option value="Parkplatz">Parkplatz</option>
        <option value="Sonstiges">Sonstiges</option>
    </select>

    <button type="submit">Create Post</button>
</form>

<hr/>

<!-- List of posts -->
<ul>
    <li th:each="post : ${posts}">
        <h2 th:text="${post.title}">Post Title</h2>
        <p th:text="${post.content}">Post Content</p>
        <p>Posted by <span th:text="${post.user.username}">User</span> on <span th:text="${post.createdAt}">Date</span></p>

        <!-- Edit Post Button -->
        <div th:if="${#authentication.name == post.user.username}">
            <button type="button" onclick="toggleEditPostForm(${post.id})">Edit Post</button>
            <!-- Inline Edit Post Form -->
            <form th:id="|editPostForm_${post.id}|" th:action="@{/posts/edit/{id}(id=${post.id})}" method="post" style="display: none;">
                <label> Title:</label>
                <input type="text" name="title" th:value="${post.title}" required /><br/>

                <label for="content">Content:</label>
                <textarea name="content" required th:text="${post.content}"></textarea><br/>

                <button type="submit">Save Changes</button>
                <button type="button" onclick="toggleEditPostForm(${post.id})">Cancel</button>
            </form>
        </div>

        <!-- Form to add a comment -->
        <form th:action="@{/posts/comment}" method="post">
            <input type="hidden" name="postId" th:value="${post.id}" />
            <textarea name="content" placeholder="Add a comment" required></textarea><br/>
            <button type="submit">Add Comment</button>
        </form>

        <!-- Display comments -->
        <ul>
            <li th:each="comment : ${post.comments}">
                <p th:text="${comment.content}">Comment Content</p>
                <p>Commented by <span th:text="${comment.user.username}">User</span> on <span th:text="${comment.createdDate}">Date</span></p>

                <!-- Edit Comment Button -->
                <div th:if="${#authentication.name == comment.user.username}">
                    <button type="button" onclick="toggleEditCommentForm(${comment.id})">Edit Comment</button>
                    <!-- Inline Edit Comment Form -->
                    <form th:id="|editCommentForm_'${comment.id}|" th:action="@{/posts/comment/edit/{id}(id=${comment.id})}" method="post" style="display: none;">
                        <textarea name="content" required th:text="${comment.content}"></textarea><br/>
                        <button type="submit">Save Changes</button>
                        <button type="button" onclick="toggleEditCommentForm(${comment.id})">Cancel</button>
                    </form>
                </div>
            </li>
        </ul>
    </li>
</ul>

<!-- Include Footer -->
<div th:insert="fragments/footer :: footer"></div>

<script>
    alert("JavaScript is working!");


function toggleEditPostForm(postId) {
    var form = document.getElementById('editPostForm_' + postId);
    if (form.style.display === 'none' || form.style.display === '') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}

function toggleEditCommentForm(commentId) {
    var form = document.getElementById('editCommentForm_' + commentId);
    if (form.style.display === 'none' || form.style.display === '') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}
</script>

</body>
</html>
